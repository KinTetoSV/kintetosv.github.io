<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ping Pong Online Multiplayer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a2a3a, #0a0e17);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow-x: hidden;
        }

        .container {
            text-align: center;
            max-width: 1000px;
            width: 100%;
            padding: 20px;
        }

        header {
            margin-bottom: 20px;
        }

        h1 {
            font-size: 3rem;
            color: #FFD700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #ccc;
            margin-bottom: 30px;
        }

        /* Screens */
        .screen {
            display: none;
            width: 100%;
        }

        .active {
            display: block;
        }

        /* Lobby Screen */
        .lobby-screen {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .connection-status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
        }

        .status-connected {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
        }

        .status-waiting {
            background: rgba(255, 193, 7, 0.2);
            color: #FFC107;
        }

        .status-disconnected {
            background: rgba(244, 67, 54, 0.2);
            color: #F44336;
        }

        .player-list {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
            flex-wrap: wrap;
            gap: 20px;
        }

        .player-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            min-width: 200px;
            transition: all 0.3s ease;
        }

        .player-card.ready {
            border: 2px solid #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }

        .player-card.waiting {
            border: 2px solid #FFC107;
        }

        /* Game Screen */
        .game-container {
            position: relative;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            margin-bottom: 20px;
        }

        #gameCanvas {
            background: #0a1429;
            border: 2px solid #FFD700;
            border-radius: 5px;
            display: block;
            margin: 0 auto;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
            max-width: 100%;
        }

        .score-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .player-score {
            background: rgba(255, 215, 0, 0.2);
            padding: 10px 20px;
            border-radius: 8px;
            min-width: 120px;
        }

        .player1 {
            color: #4FC3F7;
        }

        .player2 {
            color: #FF5252;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .player-controls {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            flex: 1;
            min-width: 200px;
        }

        .player-controls h3 {
            color: #FFD700;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .key {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 5px;
            margin: 0 5px;
            font-weight: bold;
        }

        .mobile-controls {
            display: none;
            margin-top: 20px;
            gap: 10px;
            justify-content: center;
        }

        .mobile-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 1.2rem;
            cursor: pointer;
            min-width: 80px;
        }

        .mobile-btn:active {
            background: rgba(255, 215, 0, 0.3);
        }

        /* Buttons */
        .btn {
            background: linear-gradient(to right, #FFD700, #ecc94b);
            color: #1a202c;
            border: none;
            padding: 12px 25px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
            margin: 10px 5px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
        }

        .btn:active {
            transform: translateY(1px);
        }

        .btn-ready {
            background: linear-gradient(to right, #4CAF50, #45a049);
        }

        .btn-leave {
            background: linear-gradient(to right, #FF5252, #F44336);
        }

        /* Instructions */
        .instructions {
            margin-top: 30px;
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            text-align: left;
        }

        .instructions h2 {
            color: #FFD700;
            margin-bottom: 15px;
            text-align: center;
        }

        .instructions ul {
            list-style-type: none;
            padding: 0;
        }

        .instructions li {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }

        .instructions li:before {
            content: "•";
            color: #FFD700;
            position: absolute;
            left: 0;
        }

        /* QR Code */
        .qr-container {
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 10px;
            display: inline-block;
        }

        footer {
            margin-top: 30px;
            color: #aaa;
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.2rem;
            }
            
            #gameCanvas {
                width: 100%;
                height: auto;
            }
            
            .player-list {
                flex-direction: column;
                align-items: center;
            }
            
            .mobile-controls {
                display: flex;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .player-score {
                font-size: 1.2rem;
                min-width: 100px;
                padding: 8px 15px;
            }
            
            .lobby-screen {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Ping Pong Online</h1>
            <p class="subtitle">Joacă cu prietenii de pe dispozitive diferite</p>
        </header>

        <!-- Lobby Screen -->
        <div id="lobbyScreen" class="screen active">
            <div class="lobby-screen">
                <h2>Sala de Așteptare</h2>
                
                <div id="connectionStatus" class="connection-status status-waiting">
                    <p>Se conectează la server...</p>
                </div>

                <div class="player-list">
                    <div class="player-card waiting" id="player1Card">
                        <h3>Jucător 1</h3>
                        <p id="player1Status">În așteptare...</p>
                        <p id="player1Device">-</p>
                    </div>
                    
                    <div class="player-card waiting" id="player2Card">
                        <h3>Jucător 2</h3>
                        <p id="player2Status">În așteptare...</p>
                        <p id="player2Device">-</p>
                    </div>
                </div>

                <div class="qr-container">
                    <canvas id="qrCode"></canvas>
                </div>
                <p>Scanează codul QR pentru a te conecta de pe telefon</p>

                <div>
                    <button id="readyBtn" class="btn btn-ready">SUNT GATA</button>
                    <button id="leaveBtn" class="btn btn-leave">PĂRĂSEȘTE</button>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="screen">
            <div class="score-container">
                <div class="player-score player1">Jucător 1: <span id="score1">0</span></div>
                <div class="player-score player2">Jucător 2: <span id="score2">0</span></div>
            </div>

            <div class="game-container">
                <canvas id="gameCanvas" width="800" height="400"></canvas>
                
                <div class="mobile-controls">
                    <button class="mobile-btn" id="upBtn">↑</button>
                    <button class="mobile-btn" id="downBtn">↓</button>
                </div>
                
                <div class="controls">
                    <div class="player-controls">
                        <h3>Jucător 1</h3>
                        <p>Mișcă: <span class="key">W</span> și <span class="key">S</span></p>
                    </div>
                    
                    <div class="player-controls">
                        <h3>Jucător 2</h3>
                        <p>Mișcă: <span class="key">↑</span> și <span class="key">↓</span></p>
                    </div>
                </div>
                
                <div>
                    <button id="pauseBtn" class="btn">PAUZĂ</button>
                    <button id="backToLobbyBtn" class="btn btn-leave">ÎNAPOI LA LOBBY</button>
                </div>
            </div>
        </div>

        <div class="instructions">
            <h2>Cum se joacă</h2>
            <ul>
                <li><strong>PC:</strong> Folosește tastele W/S sau săgețile pentru a mișca paleta</li>
                <li><strong>Telefon:</strong> Apasă butoanele SUS/JOS pentru a mișca paleta</li>
                <li>Primul jucător care ajunge la 5 puncte câștigă</li>
                <li>Mingea accelerează după fiecare lovitură</li>
                <li>Scanează codul QR pentru a te conecta cu telefonul</li>
            </ul>
        </div>

        <footer>
            <p>Ping Pong Online Multiplayer | Conectează-te cu prietenii de pe dispozitive diferite</p>
        </footer>
    </div>

    <script>
        // Server simulation using PeerJS and simple WebSocket-like functionality
        class GameServer {
            constructor() {
                this.players = {};
                this.gameState = null;
                this.connections = [];
            }

            connect(playerId, playerData) {
                this.players[playerId] = {
                    ...playerData,
                    ready: false,
                    score: 0,
                    connected: true
                };
                this.broadcastPlayerList();
                return true;
            }

            setReady(playerId) {
                if (this.players[playerId]) {
                    this.players[playerId].ready = true;
                    this.broadcastPlayerList();
                    
                    // Start game if both players are ready
                    const readyPlayers = Object.values(this.players).filter(p => p.ready);
                    if (readyPlayers.length === 2) {
                        this.startGame();
                    }
                }
            }

            broadcastPlayerList() {
                const playerList = Object.values(this.players);
                if (typeof window.updatePlayerList === 'function') {
                    window.updatePlayerList(playerList);
                }
            }

            startGame() {
                this.gameState = {
                    ballX: 400,
                    ballY: 200,
                    ballSpeedX: 5,
                    ballSpeedY: 3,
                    paddle1Y: 160,
                    paddle2Y: 160,
                    scores: [0, 0]
                };
                
                if (typeof window.startGame === 'function') {
                    window.startGame();
                }
            }

            updateGameState(playerId, action) {
                if (!this.gameState) return;

                // Update paddle positions based on player actions
                if (action.type === 'move') {
                    if (playerId === 'player1') {
                        this.gameState.paddle1Y = Math.max(0, Math.min(320, action.y));
                    } else if (playerId === 'player2') {
                        this.gameState.paddle2Y = Math.max(0, Math.min(320, action.y));
                    }
                }

                // Broadcast updated game state
                if (typeof window.updateGameState === 'function') {
                    window.updateGameState(this.gameState);
                }
            }
        }

        // Client-side game logic
        class PingPongGame {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.server = new GameServer();
                
                // Game state
                this.gameRunning = false;
                this.gamePaused = false;
                this.animationId = null;
                
                // Player info
                this.playerId = null;
                this.playerDevice = this.detectDevice();
                
                // Initialize
                this.init();
            }

            detectDevice() {
                const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                return isMobile ? 'mobile' : 'desktop';
            }

            init() {
                this.setupEventListeners();
                this.connectToServer();
                this.generateQRCode();
                this.drawLobby();
            }

            setupEventListeners() {
                // Lobby buttons
                document.getElementById('readyBtn').addEventListener('click', () => this.setReady());
                document.getElementById('leaveBtn').addEventListener('click', () => this.leaveGame());
                document.getElementById('backToLobbyBtn').addEventListener('click', () => this.backToLobby());
                document.getElementById('pauseBtn').addEventListener('click', () => this.togglePause());

                // Keyboard controls
                document.addEventListener('keydown', (e) => this.handleKeyDown(e));
                document.addEventListener('keyup', (e) => this.handleKeyUp(e));

                // Mobile controls
                document.getElementById('upBtn').addEventListener('touchstart', () => this.mobileMove(-1));
                document.getElementById('upBtn').addEventListener('touchend', () => this.mobileMove(0));
                document.getElementById('downBtn').addEventListener('touchstart', () => this.mobileMove(1));
                document.getElementById('downBtn').addEventListener('touchend', () => this.mobileMove(0));

                // Expose functions to global scope for server communication
                window.updatePlayerList = (players) => this.updatePlayerList(players);
                window.startGame = () => this.startGame();
                window.updateGameState = (gameState) => this.updateGameState(gameState);
            }

            connectToServer() {
                // Simulate connection delay
                setTimeout(() => {
                    this.playerId = 'player' + (Object.keys(this.server.players).length + 1);
                    const success = this.server.connect(this.playerId, {
                        name: this.playerId,
                        device: this.playerDevice
                    });

                    if (success) {
                        this.updateConnectionStatus('connected', 'Conectat la server');
                        document.getElementById('readyBtn').disabled = false;
                    }
                }, 1000);
            }

            setReady() {
                if (this.playerId) {
                    this.server.setReady(this.playerId);
                    document.getElementById('readyBtn').disabled = true;
                    document.getElementById('readyBtn').textContent = 'GATA';
                }
            }

            leaveGame() {
                // Reset game state
                this.gameRunning = false;
                this.gamePaused = false;
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                }
                
                // Show lobby
                this.showScreen('lobbyScreen');
                
                // Reset UI
                document.getElementById('readyBtn').disabled = false;
                document.getElementById('readyBtn').textContent = 'SUNT GATA';
            }

            backToLobby() {
                this.leaveGame();
            }

            startGame() {
                this.gameRunning = true;
                this.gamePaused = false;
                this.showScreen('gameScreen');
                this.animationId = requestAnimationFrame(() => this.gameLoop());
            }

            togglePause() {
                if (this.gameRunning) {
                    this.gamePaused = !this.gamePaused;
                    document.getElementById('pauseBtn').textContent = this.gamePaused ? 'CONTINUĂ' : 'PAUZĂ';
                    
                    if (this.gamePaused) {
                        cancelAnimationFrame(this.animationId);
                    } else {
                        this.animationId = requestAnimationFrame(() => this.gameLoop());
                    }
                }
            }

            handleKeyDown(e) {
                if (!this.gameRunning || this.gamePaused) return;

                let moveDirection = 0;
                if ((e.key === 'w' || e.key === 'W') && this.playerId === 'player1') {
                    moveDirection = -1;
                } else if ((e.key === 's' || e.key === 'S') && this.playerId === 'player1') {
                    moveDirection = 1;
                } else if (e.key === 'ArrowUp' && this.playerId === 'player2') {
                    moveDirection = -1;
                } else if (e.key === 'ArrowDown' && this.playerId === 'player2') {
                    moveDirection = 1;
                }

                if (moveDirection !== 0) {
                    this.sendMoveAction(moveDirection);
                }
            }

            handleKeyUp(e) {
                if (!this.gameRunning || this.gamePaused) return;

                if (
                    (e.key === 'w' || e.key === 'W' || e.key === 's' || e.key === 'S') && this.playerId === 'player1' ||
                    (e.key === 'ArrowUp' || e.key === 'ArrowDown') && this.playerId === 'player2'
                ) {
                    this.sendMoveAction(0);
                }
            }

            mobileMove(direction) {
                if (!this.gameRunning || this.gamePaused) return;
                this.sendMoveAction(direction);
            }

            sendMoveAction(direction) {
                if (this.playerId && this.server.gameState) {
                    const speed = 8;
                    let newY;

                    if (this.playerId === 'player1') {
                        newY = this.server.gameState.paddle1Y + (direction * speed);
                        newY = Math.max(0, Math.min(320, newY));
                    } else {
                        newY = this.server.gameState.paddle2Y + (direction * speed);
                        newY = Math.max(0, Math.min(320, newY));
                    }

                    this.server.updateGameState(this.playerId, {
                        type: 'move',
                        y: newY
                    });
                }
            }

            updateGameState(gameState) {
                this.server.gameState = gameState;
            }

            gameLoop() {
                if (this.gamePaused) return;

                this.update();
                this.draw();
                
                if (this.gameRunning) {
                    this.animationId = requestAnimationFrame(() => this.gameLoop());
                }
            }

            update() {
                // Game logic is handled by the server simulation
                // This is where we would normally update positions, check collisions, etc.
            }

            draw() {
                const gameState = this.server.gameState;
                if (!gameState) return;

                const ctx = this.ctx;
                const canvas = this.canvas;

                // Clear canvas
                ctx.fillStyle = '#0a1429';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Draw center line
                ctx.setLineDash([5, 15]);
                ctx.beginPath();
                ctx.moveTo(canvas.width / 2, 0);
                ctx.lineTo(canvas.width / 2, canvas.height);
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.stroke();
                ctx.setLineDash([]);

                // Draw paddles
                ctx.fillStyle = '#4FC3F7';
                ctx.fillRect(0, gameState.paddle1Y, 10, 80);

                ctx.fillStyle = '#FF5252';
                ctx.fillRect(canvas.width - 10, gameState.paddle2Y, 10, 80);

                // Draw ball
                ctx.fillStyle = '#FFD700';
                ctx.beginPath();
                ctx.arc(gameState.ballX, gameState.ballY, 5, 0, Math.PI * 2);
                ctx.fill();

                // Update scores
                document.getElementById('score1').textContent = gameState.scores[0];
                document.getElementById('score2').textContent = gameState.scores[1];
            }

            drawLobby() {
                // Simple lobby drawing
                const ctx = this.ctx;
                const canvas = this.canvas;

                ctx.fillStyle = '#0a1429';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                ctx.fillStyle = '#FFD700';
                ctx.font = '30px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('SALA DE AȘTEPTARE', canvas.width / 2, canvas.height / 2 - 50);

                ctx.fillStyle = 'white';
                ctx.font = '20px Arial';
                ctx.fillText('Așteptând jucători...', canvas.width / 2, canvas.height / 2 + 20);
            }

            updatePlayerList(players) {
                players.forEach((player, index) => {
                    const playerNum = index + 1;
                    const card = document.getElementById(`player${playerNum}Card`);
                    const status = document.getElementById(`player${playerNum}Status`);
                    const device = document.getElementById(`player${playerNum}Device`);

                    if (player.connected) {
                        card.classList.remove('waiting');
                        status.textContent = player.ready ? 'Gata' : 'În așteptare';
                        device.textContent = player.device === 'mobile' ? '📱 Telefon' : '💻 Computer';
                        
                        if (player.ready) {
                            card.classList.add('ready');
                        }
                    }
                });
            }

            updateConnectionStatus(status, message) {
                const element = document.getElementById('connectionStatus');
                element.className = `connection-status status-${status}`;
                element.innerHTML = `<p>${message}</p>`;
            }

            showScreen(screenId) {
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.remove('active');
                });
                document.getElementById(screenId).classList.add('active');
            }

            generateQRCode() {
                const canvas = document.getElementById('qrCode');
                const ctx = canvas.getContext('2d');
                
                // Simple QR code simulation
                canvas.width = 200;
                canvas.height = 200;
                
                // Draw a simple pattern that looks like a QR code
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, 200, 200);
                
                ctx.fillStyle = 'black';
                // Draw corner markers
                ctx.fillRect(10, 10, 50, 50);
                ctx.fillRect(140, 10, 50, 50);
                ctx.fillRect(10, 140, 50, 50);
                
                // Draw some random blocks to simulate QR code
                for (let i = 0; i < 100; i++) {
                    const x = Math.floor(Math.random() * 160) + 20;
                    const y = Math.floor(Math.random() * 160) + 20;
                    const size = Math.random() > 0.7 ? 10 : 5;
                    ctx.fillRect(x, y, size, size);
                }
                
                ctx.fillStyle = 'black';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Scan me!', 100, 190);
            }
        }

        // Initialize the game when page loads
        window.addEventListener('load', () => {
            new PingPongGame();
        });
    </script>
</body>
</html>
